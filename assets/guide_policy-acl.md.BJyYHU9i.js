import{_ as l,C as n,c as r,o as a,a2 as s,b as p,w as t,a as c,G as i,a3 as d}from"./chunks/framework.CulRYwFH.js";const v=JSON.parse('{"title":"üõ°Ô∏è Context-Aware RBAC with FastMCP + Vault + File-Based Policy","description":"","frontmatter":{},"headers":[],"relativePath":"guide/policy-acl.md","filePath":"guide/policy-acl.md"}'),u={name:"guide/policy-acl.md"};function h(D,e,y,m,b,F){const o=n("Mermaid");return a(),r("div",null,[e[1]||(e[1]=s('<h1 id="üõ°Ô∏è-context-aware-rbac-with-fastmcp-vault-file-based-policy" tabindex="-1">üõ°Ô∏è Context-Aware RBAC with FastMCP + Vault + File-Based Policy <a class="header-anchor" href="#üõ°Ô∏è-context-aware-rbac-with-fastmcp-vault-file-based-policy" aria-label="Permalink to &quot;üõ°Ô∏è Context-Aware RBAC with FastMCP + Vault + File-Based Policy&quot;">‚Äã</a></h1><p>This demo MCP server supports pluggable policy enforcement using the Adapter pattern.<br> It implements <strong>context-aware RBAC</strong> using two interchangeable enforcers:</p><ul><li>‚úÖ <code>HashiCorpVaultPolicyEnforcer</code></li><li>‚úÖ <code>FilePolicyEnforcer</code></li></ul><hr><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">‚Äã</a></h2><p>When a tool is called via FastMCP, the <code>PolicyMiddleware</code> intercepts the request using the <code>on_call_tool</code> hook.<br> It delegates access checks to the active enforcer based on role and context.</p><hr><h2 id="mermaid-diagram" tabindex="-1">Mermaid Diagram <a class="header-anchor" href="#mermaid-diagram" aria-label="Permalink to &quot;Mermaid Diagram&quot;">‚Äã</a></h2>',8)),(a(),p(d,null,{default:t(()=>[i(o,{id:"mermaid-29",class:"mermaid-block",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20MCP%20Server%0A%20%20%20%20participant%20Middleware%0A%20%20%20%20participant%20Vault%20OR%20File%0A%20%20%20%20participant%20Tool%0A%0A%20%20%20%20User-%3E%3EMCP%20Server%3A%20Call%20tool%20%22generate_report%22%20with%20context%0A%20%20%20%20MCP%20Server-%3E%3EMiddleware%3A%20on_call_tool(tool%2C%20context)%0A%20%20%20%20Middleware-%3E%3EVault%20OR%20File%3A%20is_allowed(tool_name%2C%20context)%0A%20%20%20%20alt%20Access%20Granted%0A%20%20%20%20%20%20%20%20Vault%20OR%20File--%3E%3EMiddleware%3A%20true%0A%20%20%20%20%20%20%20%20Middleware--%3E%3EMCP%20Server%3A%20proceed%0A%20%20%20%20%20%20%20%20MCP%20Server-%3E%3ETool%3A%20call(tool)%0A%20%20%20%20%20%20%20%20Tool--%3E%3EMCP%20Server%3A%20return%20result%0A%20%20%20%20%20%20%20%20MCP%20Server--%3E%3EUser%3A%20result%0A%20%20%20%20else%20Access%20Denied%0A%20%20%20%20%20%20%20%20Vault%20OR%20File--%3E%3EMiddleware%3A%20false%0A%20%20%20%20%20%20%20%20Middleware--%3E%3EMCP%20Server%3A%20raise%20PermissionError%0A%20%20%20%20%20%20%20%20MCP%20Server--%3E%3EUser%3A%20error%3A%20Access%20Denied%0A%20%20%20%20end%0A"})]),fallback:t(()=>e[0]||(e[0]=[c(" Loading... ",-1)])),_:1})),e[2]||(e[2]=s(`<hr><h2 id="quick-start" tabindex="-1">Quick Start <a class="header-anchor" href="#quick-start" aria-label="Permalink to &quot;Quick Start&quot;">‚Äã</a></h2><h3 id="_1-vault-mode" tabindex="-1">1. Vault Mode <a class="header-anchor" href="#_1-vault-mode" aria-label="Permalink to &quot;1. Vault Mode&quot;">‚Äã</a></h3><h4 id="install-vault-on-your-local-machine" tabindex="-1">Install vault on your local machine <a class="header-anchor" href="#install-vault-on-your-local-machine" aria-label="Permalink to &quot;Install vault on your local machine&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">brew</span><span style="color:#C3E88D;"> tap</span><span style="color:#C3E88D;"> hashicorp/tap</span></span>
<span class="line"><span style="color:#FFCB6B;">brew</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> hashicorp/tap/vault</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="start-vault-in-dev-mode" tabindex="-1">Start Vault in Dev Mode <a class="header-anchor" href="#start-vault-in-dev-mode" aria-label="Permalink to &quot;Start Vault in Dev Mode&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vault</span><span style="color:#C3E88D;"> server</span><span style="color:#C3E88D;"> -dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>In a new terminal:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#BABED8;"> VAULT_ADDR</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">http://127.0.0.1:8200</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#BABED8;"> VAULT_TOKEN</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">root</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>check the vault status by running <code>vault status</code></p><h4 id="store-policies" tabindex="-1">Store Policies <a class="header-anchor" href="#store-policies" aria-label="Permalink to &quot;Store Policies&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vault</span><span style="color:#C3E88D;"> kv</span><span style="color:#C3E88D;"> put</span><span style="color:#C3E88D;"> secret/mcp-policies/agent_worker</span><span style="color:#C3E88D;"> tools=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[&quot;generate_report&quot;, &quot;check_status&quot;]</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">vault</span><span style="color:#C3E88D;"> kv</span><span style="color:#C3E88D;"> put</span><span style="color:#C3E88D;"> secret/mcp-policies/user</span><span style="color:#C3E88D;"> tools=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[&quot;start_cluster&quot;, &quot;read_user_data&quot;, &quot;check_status&quot;]</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">vault</span><span style="color:#C3E88D;"> kv</span><span style="color:#C3E88D;"> put</span><span style="color:#C3E88D;"> secret/mcp-policies/agent_supervisor</span><span style="color:#C3E88D;"> tools=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[&quot;terminate_cluster&quot;, &quot;start_cluster&quot;, &quot;generate_report&quot;]</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>So the tool access policy are as follows:</p><table tabindex="0"><thead><tr><th>Tool Name</th><th>Description</th><th>Who Can Access</th></tr></thead><tbody><tr><td><code>start_cluster()</code></td><td>Starts a compute cluster</td><td><code>agent_supervisor</code>, <code>user</code></td></tr><tr><td><code>check_status()</code></td><td>Checks service health</td><td>all roles</td></tr><tr><td><code>terminate_cluster()</code></td><td>Terminates compute cluster</td><td><code>agent_supervisor</code> only</td></tr><tr><td><code>generate_report()</code></td><td>Creates compliance report</td><td><code>agent_worker</code>, <code>agent_supervisor</code></td></tr><tr><td><code>read_user_data()</code></td><td>Fetch PII data (sensitive)</td><td><code>user</code> only</td></tr></tbody></table><h4 id="run-the-server" tabindex="-1">Run the Server <a class="header-anchor" href="#run-the-server" aria-label="Permalink to &quot;Run the Server&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#BABED8;"> POLICY_ENFORCER_MODE</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">vault</span></span>
<span class="line"><span style="color:#FFCB6B;">uv</span><span style="color:#C3E88D;"> run</span><span style="color:#C3E88D;"> test/test_policy.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr><h3 id="_3-file-mode" tabindex="-1">3. File Mode <a class="header-anchor" href="#_3-file-mode" aria-label="Permalink to &quot;3. File Mode&quot;">‚Äã</a></h3><h4 id="policy-json" tabindex="-1"><code>policy.json</code> <a class="header-anchor" href="#policy-json" aria-label="Permalink to &quot;\`policy.json\`&quot;">‚Äã</a></h4><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">agent_worker</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">generate_report</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">check_status</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">user</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">start_cluster</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">read_user_data</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">check_status</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">agent_supervisor</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">terminate_cluster</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">start_cluster</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">generate_report</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="run-the-server-1" tabindex="-1">Run the Server <a class="header-anchor" href="#run-the-server-1" aria-label="Permalink to &quot;Run the Server&quot;">‚Äã</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#BABED8;"> POLICY_ENFORCER_MODE</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">file</span></span>
<span class="line"><span style="color:#FFCB6B;">uv</span><span style="color:#C3E88D;"> run</span><span style="color:#C3E88D;"> test/test_policy.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr><h2 id="test-example-tool-call" tabindex="-1">Test Example Tool Call <a class="header-anchor" href="#test-example-tool-call" aria-label="Permalink to &quot;Test Example Tool Call&quot;">‚Äã</a></h2><p>Example context:</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">role</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">agent_worker</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>If the tool is <code>generate_report</code>, access is granted ‚úÖ<br> If the tool is <code>terminate_cluster</code>, access is denied ‚ùå</p><hr><h2 id="tools-provided" tabindex="-1">Tools Provided <a class="header-anchor" href="#tools-provided" aria-label="Permalink to &quot;Tools Provided&quot;">‚Äã</a></h2><ul><li><code>start_cluster</code></li><li><code>terminate_cluster</code></li><li><code>generate_report</code></li><li><code>check_status</code></li><li><code>read_user_data</code></li></ul><hr><h2 id="extending" tabindex="-1">Extending <a class="header-anchor" href="#extending" aria-label="Permalink to &quot;Extending&quot;">‚Äã</a></h2><p>You can add new enforcers (e.g., OPA, JWT, Permit) via the Adapter interface in <code>BasePolicyEnforcer</code>.</p><hr><h2 id="demo-with-mcp-inspector" tabindex="-1">Demo with MCP Inspector <a class="header-anchor" href="#demo-with-mcp-inspector" aria-label="Permalink to &quot;Demo with MCP Inspector&quot;">‚Äã</a></h2>`,35))])}const _=l(u,[["render",h]]);export{v as __pageData,_ as default};
